mapscripts DrisledgeTown_MapScripts {
    MAP_SCRIPT_ON_TRANSITION: DrisledgeTownOnTransition
    MAP_SCRIPT_ON_LOAD: DrisledgeTownOnLoad 
}

script DrisledgeTownOnLoad{
    gettime
    copyvar(VAR_TEMP_0, VAR_0x8000)
    // call(SetDrisledgeNPCs)
    call(SetDrisledgeGym)
    // if(var(VAR_DRISLEDGE_TOWN_STATE) >= 30){
    //     call(SetUpBrokenDrisledge)
    //     if(var(VAR_TEMP_0) <= 6 || var(VAR_TEMP_0) >= 18){
    //         call(SetUpGhostTownDrisledge)
    //     }
    // }
}

script DrisledgeTownOnTransition{
    setflag(FLAG_VISITED_DRISLEDGE)
    gettime
    copyvar(VAR_TEMP_0, VAR_0x8000)
    special(SetDrisledgeWeather)
    call(SetDrisledgeNPCs)
    call(SetDrisledgeGym)
    if(var(VAR_DRISLEDGE_TOWN_STATE) >= 30){
        if(var(VAR_TEMP_0) <= 6 || var(VAR_TEMP_0) >= 18){
            setmaplayoutindex(LAYOUT_DRISLEDGE_TOWN_BROKEN2)
        }
        else{
            setmaplayoutindex(LAYOUT_DRISLEDGE_TOWN_BROKEN)
        }
    }
}

script SetDrisledgeNPCs{
    setflag(FLAG_TEMP_2)
    if(var(VAR_DRISLEDGE_TOWN_STATE) >= 7){
        setflag(FLAG_TEMP_1)
    }
    if((var(VAR_DRISLEDGE_TOWN_STATE) >= 30) && (var(VAR_TEMP_0) <= 6 || var(VAR_TEMP_0) >= 18)){
        clearflag(FLAG_TEMP_2)
    }
    return
}

script SetUpBrokenDrisledge{
    call(SetUpDrisledgeTrees)
    call(SetUpDrisledgeBushes)
    call(SetUpDrisledgePuddles)
    call(SetUpDrisledgeHouses)
    return
}
script SetUpGhostTownDrisledge{
    return
}
script SetUpDrisledgeTrees{
    setmetatile(23, 22, 0x204, FALSE)
    setmetatile(22, 14, 0x204, FALSE)
    setmetatile(24, 11, 0x204, FALSE)
    setmetatile(9, 6, 0x254, FALSE)
    setmetatile(10, 6, 0x254, FALSE)
    setmetatile(11, 6, 0x254, FALSE)
    setmetatile(9, 7, 0x254, FALSE)
    setmetatile(10, 7, 0x254, FALSE)
    setmetatile(11, 7, 0x254, FALSE)
    setmetatile(9, 8, 0x254, FALSE)
    setmetatile(10, 8, 0x254, FALSE)
    setmetatile(7, 8, 0x254, FALSE)
    setmetatile(8, 8, 0x254, FALSE)
    setmetatile(7, 9, 0x254, FALSE)
    setmetatile(8, 9, 0x254, FALSE)
    return
}

script SetUpDrisledgeBushes{
    setmetatile(14, 1, 0x205, FALSE)
    setmetatile(15, 4, 0x205, FALSE)
    setmetatile(18, 4, 0x205, FALSE)
    setmetatile(20, 5, 0x205, FALSE)
    setmetatile(28, 6, 0x205, FALSE)
    setmetatile(15, 7, 0x205, FALSE)
    setmetatile(15, 8, 0x205, FALSE)
    setmetatile(26, 9, 0x205, FALSE)
    setmetatile(27, 9, 0x205, FALSE)
    setmetatile(27, 10, 0x205, FALSE)
    setmetatile(25, 11, 0x205, FALSE)
    setmetatile(25, 12, 0x205, FALSE)
    setmetatile(22, 12, 0x205, FALSE)
    setmetatile(16, 12, 0x205, FALSE)
    setmetatile(17, 12, 0x205, FALSE)
    setmetatile(12, 12, 0x205, FALSE)
    setmetatile(12, 13, 0x205, FALSE)
    setmetatile(15, 14, 0x205, FALSE)
    setmetatile(15, 15, 0x205, FALSE)
    setmetatile(20, 14, 0x205, FALSE)
    setmetatile(20, 15, 0x205, FALSE)
    setmetatile(20, 16, 0x205, FALSE)
    setmetatile(21, 15, 0x205, FALSE)
    setmetatile(24, 14, 0x205, FALSE)
    setmetatile(5, 21, 0x205, FALSE)
    setmetatile(5, 22, 0x205, FALSE)
    setmetatile(6, 22, 0x205, FALSE)
    setmetatile(6, 24, 0x205, FALSE)
    setmetatile(11, 23, 0x205, FALSE)
    setmetatile(12, 22, 0x205, FALSE)
    setmetatile(20, 22, 0x205, FALSE)
    setmetatile(20, 24, 0x205, FALSE)
    setmetatile(21, 23, 0x205, FALSE)
    setmetatile(23, 24, 0x205, FALSE)
    return
}
script SetUpDrisledgePuddles{
    setmetatile(13, 5, 0x254, FALSE)
    setmetatile(14, 5, 0x254, FALSE)
    setmetatile(12, 6, 0x254, FALSE)
    setmetatile(13, 6, 0x254, FALSE)
    setmetatile(14, 6, 0x254, FALSE)
    setmetatile(12, 7, 0x254, FALSE)
    setmetatile(13, 7, 0x254, FALSE)
    setmetatile(14, 7, 0x254, FALSE)
    setmetatile(9, 9, 0x254, FALSE)
    setmetatile(10, 9, 0x254, FALSE)
    setmetatile(11, 9, 0x254, FALSE)
    setmetatile(8, 10, 0x254, FALSE)
    setmetatile(9, 10, 0x254, FALSE)
    setmetatile(10, 10, 0x254, FALSE)
    setmetatile(11, 10, 0x254, FALSE)
    setmetatile(8, 11, 0x254, FALSE)
    setmetatile(9, 11, 0x254, FALSE)
    setmetatile(10, 11, 0x254, FALSE)
    setmetatile(11, 11, 0x254, FALSE)
    return
}
script SetUpDrisledgeHouses{
    setmetatile(7, 21, 0x2E8, FALSE)
    setmetatile(8, 21, 0x2E9, FALSE)
    setmetatile(9, 21, 0x2EA, FALSE)
    setmetatile(10, 21, 0x2EB, FALSE)

    setmetatile(7, 22, 0x2F4, TRUE)
    setmetatile(8, 22, 0x2F5, TRUE)
    setmetatile(9, 22, 0x2F2, TRUE)
    setmetatile(10, 22, 0x2F3, TRUE)

    setmetatile(7, 23, 0x2F8, TRUE)
    setmetatile(8, 23, 0x2FD, TRUE)
    setmetatile(9, 23, 0x2FA, TRUE)
    setmetatile(10, 23, 0x2FB, TRUE)

    setmetatile(7, 24, 0x300, TRUE)
    setmetatile(9, 24, 0x302, TRUE)
    setmetatile(10, 24, 0x303, TRUE)
    //
    setmetatile(7+9, 21-8, 0x2E8, FALSE)
    setmetatile(8+9, 21-8, 0x2E9, FALSE)
    setmetatile(9+9, 21-8, 0x2EA, FALSE)
    setmetatile(10+9, 21-8, 0x2EB, FALSE)

    setmetatile(7+9, 22-8, 0x2F4, TRUE)
    setmetatile(8+9, 22-8, 0x2F5, TRUE)
    setmetatile(9+9, 22-8, 0x2F2, TRUE)
    setmetatile(10+9, 22-8, 0x2F3, TRUE)

    setmetatile(7+9, 23-8, 0x2F8, TRUE)
    setmetatile(8+9, 23-8, 0x2FD, TRUE)
    setmetatile(9+9, 23-8, 0x2FA, TRUE)
    setmetatile(10+9, 23-8, 0x2FB, TRUE)

    setmetatile(7+9, 24-8, 0x300, TRUE)
    setmetatile(9+9, 24-8, 0x302, TRUE)
    setmetatile(10+9, 24-8, 0x303, TRUE)
    return
}

script SetDrisledgeGym{
    if(var(VAR_DRISLEDGE_TOWN_STATE) >= 30){
        setdynamicwarp(MAP_DRISLEDGE_GYM_HOUSE, 4, 8)
    }
    else{
        setdynamicwarp(MAP_DRISLEDGE_GYM, 5, 51)
    }
    return
}

script Drisledge_Sign1{
    msgbox(Drisledge_Sign1_Text, MSGBOX_SIGN)
}
text Drisledge_Sign1_Text{
    "DRISLEDGE TOWN\n"
    "“The happiest town in the world.”"
}

script Drisledge_Sign2{
    msgbox(Drisledge_Sign2_Text, MSGBOX_SIGN)
}
text Drisledge_Sign2_Text{
    "Drisledge Town Pokémon Gym"
}

script DrisledgeMart_OldMan{
    lock
    msgbox(DrisledgeMart_OldMan_Text)
    call(SetDrisledgeOldPersonVar)
    release
}
text DrisledgeMart_OldMan_Text{
    "I feel like the products here are\n"
    "constantly changing locations.\l"
    "I can never find what I want."
}

script Drisledge_LittleGirl{
    msgbox(Drisledge_LittleGirl_Text, MSGBOX_NPC)
    if(var(VAR_DRISLEDGE_TOWN_STATE) >= 10){
        end
    }
    if((var(VAR_DRISLEDGE_TOWN_STATE) != 1)
    || (var(VAR_DRISLEDGE_TOWN_STATE) != 3)
    || (var(VAR_DRISLEDGE_TOWN_STATE) != 5)
    || (var(VAR_DRISLEDGE_TOWN_STATE) != 7))
    {
        addvar(VAR_DRISLEDGE_TOWN_STATE, 1)
    }
}
text Drisledge_LittleGirl_Text{
    "The adults hate the rain so there's\n"
    "nobody to ruin our fun out here!"
}
script Drisledge_LittleGirl2{
    msgbox(Drisledge_LittleGirl_Text2, MSGBOX_NPC)
    if(var(VAR_DRISLEDGE_TOWN_STATE) >= 10){
        end
    }
    if((var(VAR_DRISLEDGE_TOWN_STATE) != 2)
    || (var(VAR_DRISLEDGE_TOWN_STATE) != 3)
    || (var(VAR_DRISLEDGE_TOWN_STATE) != 6)
    || (var(VAR_DRISLEDGE_TOWN_STATE) != 7))
    {
        addvar(VAR_DRISLEDGE_TOWN_STATE, 2)
    }
}
text Drisledge_LittleGirl_Text2{
    "Whee!"
}
script SetDrisledgeOldPersonVar{
    if(var(VAR_DRISLEDGE_TOWN_STATE) >= 10){
        release
        end
    }
    if((var(VAR_DRISLEDGE_TOWN_STATE) != 4)
    || (var(VAR_DRISLEDGE_TOWN_STATE) != 5)
    || (var(VAR_DRISLEDGE_TOWN_STATE) != 6)
    || (var(VAR_DRISLEDGE_TOWN_STATE) != 7))
    {
        addvar(VAR_DRISLEDGE_TOWN_STATE, 4)
    }
}

script DrisledgeTown_House2_ExpertM{
    lock
    msgbox(DrisledgeTown_House2_ExpertM_Text)
    call(SetDrisledgeOldPersonVar)
    release
}
script DrisledgeTown_House2_ExpertF{
    msgbox(DrisledgeTown_House2_ExpertF_Text, MSGBOX_NPC)
    call(SetDrisledgeOldPersonVar)
}
text DrisledgeTown_House2_ExpertM_Text{
    "Another rainy day…\n"
    "Splendid…"
}
text DrisledgeTown_House2_ExpertF_Text{
    "There's not much to do in a town\n"
    "where it never stops raining.\p"
    "At least the sound of raindrops\n"
    "hitting the roof is relaxing, I guess…"
}

script Drisledge_House1_OldWoman{
    msgbox(Drisledge_House1_OldWoman_Text, MSGBOX_NPC)
    call(SetDrisledgeOldPersonVar)
}
text Drisledge_House1_OldWoman_Text{
    "Do you like my dolls?\p"
    "Sometimes it can be a bit noisy when\n"
    "everybody starts talking at the same\l"
    "time, but other than that, they tend to\l"
    "be very well-behaved."
}

script DrisledgeDoll1{
    bufferspeciesname(STR_VAR_1, SPECIES_SEEDOT)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll2{
    bufferspeciesname(STR_VAR_1, SPECIES_SMOOCHUM)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll3{
    bufferspeciesname(STR_VAR_1, SPECIES_GULPIN)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll4{
    bufferspeciesname(STR_VAR_1, SPECIES_CLEFAIRY)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll5{
    bufferspeciesname(STR_VAR_1, SPECIES_DUSKULL)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll6{
    bufferspeciesname(STR_VAR_1, SPECIES_JIGGLYPUFF)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll7{
    bufferspeciesname(STR_VAR_1, SPECIES_AZURILL)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll8{
    bufferspeciesname(STR_VAR_1, SPECIES_WYNAUT)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll9{
    bufferspeciesname(STR_VAR_1, SPECIES_DITTO)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll10{
    bufferspeciesname(STR_VAR_1, SPECIES_KECLEON)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll11{
    bufferspeciesname(STR_VAR_1, SPECIES_LOTAD)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll12{
    bufferspeciesname(STR_VAR_1, SPECIES_MEOWTH)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll13{
    bufferspeciesname(STR_VAR_1, SPECIES_WOOPER)
    goto(DrisledgeDollMain)
}
script DrisledgeDoll14{
    bufferspeciesname(STR_VAR_1, SPECIES_TOGEPI)
    goto(DrisledgeDollMain)
}
script DrisledgeDollMain{
    msgbox(DrisledgeDollMain_Text, MSGBOX_SIGN)
}
text DrisledgeDollMain_Text{
    "It's a regular {STR_VAR_1} doll."
}

script Drisledge_Pokecenter_Boy3{
    msgbox(Drisledge_Pokecenter_Boy3_Text, MSGBOX_NPC)
}
script Drisledge_Pokecenter_Man1{
    msgbox(Drisledge_Pokecenter_Man1_Text, MSGBOX_NPC)
}
script Drisledge_Pokecenter_Girl2{
    msgbox(Drisledge_Pokecenter_Girl2_Text, MSGBOX_NPC)
}
text Drisledge_Pokecenter_Boy3_Text{
    "Is it just me or are the locals\n"
    "a bit weird?"
}
text Drisledge_Pokecenter_Man1_Text{
    "I was afraid we might get drenched\n"
    "on our way here.\p"
    "Thankfully my Pokémon was holding\n"
    "a Utility Umbrella and was able to\l"
    "keep us dry through the rain."
}
text Drisledge_Pokecenter_Girl2_Text{
    "I hate the rain.\n"
    "I hope it stops soon."
}

script DrisledgeGymToggle{
    if(var(VAR_DRISLEDGE_TOWN_STATE) == 30){
        setvar(VAR_DRISLEDGE_TOWN_STATE, 1)
        msgbox("Town state changed.", MSGBOX_SIGN)
    }
    else{
        setvar(VAR_DRISLEDGE_TOWN_STATE, 30)
        msgbox("Town state changed.", MSGBOX_SIGN) 
    }
}

script Drisledge_BerryGastly{
    lock
	faceplayer
	waitse
	playmoncry(SPECIES_GASTLY, CRY_MODE_NORMAL)
	msgbox(DrisledgeGastly_Text, MSGBOX_DEFAULT)
	waitmoncry
    if(!flag(FLAG_DRISLEDGE_ITEM2)){
        giveitem(ITEM_ORAN_BERRY)
        setflag(FLAG_DRISLEDGE_ITEM2)
    }
	release
	end
}
script Drisledge_Haunter{
    lock
	faceplayer
	waitse
	playmoncry(SPECIES_HAUNTER, CRY_MODE_NORMAL)
	msgbox(DrisledgeHaunter_Text, MSGBOX_DEFAULT)
	waitmoncry
	release
	end
}
text DrisledgeHaunter_Text{
    "Haaan!"
}

script DrisledgeBanette{
    lock
	faceplayer
	waitse
	playmoncry(SPECIES_BANETTE, CRY_MODE_NORMAL)
	msgbox(DrisledgeBanette_Text, MSGBOX_DEFAULT)
	waitmoncry
	release
	end
}
script DrisledgeBanette1{
    lock
	faceplayer
	waitse
	playmoncry(SPECIES_BANETTE, CRY_MODE_NORMAL)
	msgbox(DrisledgeBanette_Text, MSGBOX_DEFAULT)
	waitmoncry
    if(!flag(FLAG_DRISLEDGE_ITEM3)){
        giveitem(ITEM_COLBUR_BERRY)
        setflag(FLAG_DRISLEDGE_ITEM3)
    }
	release
	end
}
text DrisledgeBanette_Text{
    "Baaan!"
}

script Drisledge_Acerola{
    checkplayergender
    if(var(VAR_RESULT) == MALE){
        bufferstring(STR_VAR_1, "mister")
    }
    else{
        bufferstring(STR_VAR_1, "miss")
    }
    if(flag(FLAG_RECEIVED_HM_SURF)){
        if(flag(FLAG_ACEROLA_ITEM)){
            msgbox(AcerolaWithFriends, MSGBOX_NPC)
            end
        }
        if(var(VAR_TEMP_3) == 1){
            msgbox(AcerolaLetsDance, MSGBOX_NPC)
            end
        }
        msgbox(AcerolaYoureBack, MSGBOX_NPC)
        if(!flag(FLAG_ACEROLA_ITEM)){
            setvar(VAR_TEMP_3, 1)   //starts dance event
        }
    }
    else{
        msgbox(AcerolaCheckWithScientist, MSGBOX_NPC)
    }
}
text AcerolaWithFriends{
    "If you're not busy, you\n"
    "could stay here forever!\p"
    "We can keep dancing and having\n"
    "fun with friends!"
}
script AcerolaDanceTriggerCorner{
    addvar(VAR_TEMP_4, 1)
    release
}
script AcerolaDanceTriggerWest{
    setvar(VAR_TEMP_5, 1)
    goto(AcerolaDanceTriggerMain)
}
script AcerolaDanceTriggerNorth{
    setvar(VAR_TEMP_5, 2)
    goto(AcerolaDanceTriggerMain)
}
script AcerolaDanceTriggerEast{
    setvar(VAR_TEMP_5, 3)
    goto(AcerolaDanceTriggerMain)
}
script AcerolaDanceTriggerSouth{
    setvar(VAR_TEMP_5, 4)
    goto(AcerolaDanceTriggerMain)
}
script AcerolaDanceTriggerMain{
    addvar(VAR_TEMP_4, 1)
    if(var(VAR_TEMP_4) < 50){
        release
        end
    }
    checkitemspace(ITEM_BUG_TERA_SHARD)
    if(var(VAR_RESULT) == FALSE){
        release
        end
    }
    lock
    safefollow
    applymovement(6, WW_Face)
    waitmovement(0)
    playse(SE_PIN)
    applymovement(6, ExclamationMark)
    waitmovement(0)
    delay(48)
    switch(var(VAR_TEMP_5)){
        case 1:
            turnobject(OBJ_EVENT_ID_PLAYER, DIR_EAST)
        case 2:
            turnobject(OBJ_EVENT_ID_PLAYER, DIR_SOUTH)
        case 3:
            turnobject(OBJ_EVENT_ID_PLAYER, DIR_WEST)
        case 4:
            turnobject(OBJ_EVENT_ID_PLAYER, DIR_NORTH)
    }
    delay(15)
    checkplayergender
    if(var(VAR_RESULT) == MALE){
        bufferstring(STR_VAR_1, "mister")
    }
    else{
        bufferstring(STR_VAR_1, "miss")
    }
    msgbox(AcerolaGoodDancer)
    giveitem(ITEM_TM_CAPTIVATE)
    setflag(FLAG_ACEROLA_ITEM)
    setvar(VAR_TEMP_3, 0)
    release
}
text AcerolaLetsDance{
    "Yay! Now we've got a real\n"
    "dance party going!"
}
text AcerolaGoodDancer{
    "Wow, {STR_VAR_1}, you're\n"
    "a really good dancer!\p"
    "One of my friends was so impressed\n"
    "that they wanted you to have this."
}

text AcerolaYoureBack{
    "Hiya, {STR_VAR_1}!\p"
    "I'm just having some fun with\n"
    "my friends.\p"
    "If you don't have anything else in\n"
    "your mind, would you like to join us?\p"
    "We can keep dancing until our legs no\n"
    "longer have the energy to carry us!"
}
text AcerolaCheckWithScientist{
    "Hiya, {STR_VAR_1}!\p"
    "I'm just having some fun with\n"
    "my friends.\p"
    "Did you already visit yours near\n"
    "Amberock Town?"
}
script Drisledge_Gengar{
    lock
	faceplayer
	waitse
	playmoncry(SPECIES_GENGAR, CRY_MODE_NORMAL)
	msgbox(DrisledgeGengar_Text, MSGBOX_DEFAULT)
	waitmoncry
	release
	end
}
text DrisledgeGengar_Text{
    "Gen gen!"
}
script Drisledge_Mismagius{
    lock
	faceplayer
	waitse
	playmoncry(SPECIES_MISMAGIUS, CRY_MODE_NORMAL)
	msgbox(DrisledgeMisdreavus_Text, MSGBOX_DEFAULT)
	waitmoncry
	release
	end
}

script Drisledge_Mimikyu{
    lock
	faceplayer
	waitse
	playmoncry(SPECIES_MIMIKYU, CRY_MODE_NORMAL)
	msgbox(DrisledgeMimikyu_Text, MSGBOX_DEFAULT)
	waitmoncry
	release
	end
}

text DrisledgeMimikyu_Text{
    "Mii-mii!"
}